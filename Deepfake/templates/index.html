<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CyberEye</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: radial-gradient(circle at top left, #050505, #0a0f24 60%, #000);
      color: #e0e0e0;
      font-family: 'Poppins', sans-serif;
      min-height: 100vh;
    }

    /* Navbar */
    .navbar {
      background: rgba(0, 0, 0, 0.8);
      border-bottom: 1px solid #00e5ff;
      box-shadow: 0 0 10px #00e5ff40;
    }
    .navbar-brand {
      font-weight: 700;
      color: #00e5ff !important;
      letter-spacing: 1px;
      text-shadow: 0 0 10px #00e5ff;
    }
    .navbar .btn-outline-light {
      border-color: #00e5ff;
      color: #00e5ff;
    }
    .navbar .btn-outline-light:hover {
      background-color: #00e5ff;
      color: #000;
    }

    /* Main card */
    .card {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid #00e5ff40;
      border-radius: 15px;
      box-shadow: 0 0 20px #00e5ff30;
      backdrop-filter: blur(10px);
    }

    h2 {
      color: #00e5ff;
      text-shadow: 0 0 15px #00e5ff60;
    }

    label, .form-label, .form-select, .form-control {
      color: #e0e0e0 !important;
      background: rgba(255, 255, 255, 0.05) !important;
      border: 1px solid #00e5ff40;
      border-radius: 8px;
    }
    .form-select:focus, .form-control:focus {
      box-shadow: 0 0 10px #00e5ff80;
      border-color: #00e5ff;
    }

    .btn-primary {
      background: linear-gradient(90deg, #00e5ff, #007bff);
      border: none;
      font-weight: 600;
      box-shadow: 0 0 10px #00e5ff60;
    }
    .btn-primary:hover {
      background: linear-gradient(90deg, #00b8d4, #0062cc);
      box-shadow: 0 0 20px #00e5ff90;
    }

    /* Summary Section */
    .summary-container {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid #00e5ff30;
      box-shadow: 0 0 15px #00e5ff20;
      border-radius: 12px;
      padding: 20px;
    }

    #summary-list li {
      border-bottom: 1px dashed #00e5ff30;
      padding: 8px 0;
      font-size: 1rem;
    }

    /* Buttons */
    #view-frames-btn {
      background: linear-gradient(90deg, #00e676, #00c853);
      font-weight: 600;
      box-shadow: 0 0 15px #00e67660;
    }
    #view-frames-btn:hover {
      box-shadow: 0 0 25px #00e676aa;
    }

    #close-view {
      background-color: #ff1744;
      border: none;
      font-weight: 600;
      box-shadow: 0 0 10px #ff174460;
    }
    #close-view:hover {
      background-color: #d50000;
      box-shadow: 0 0 20px #ff1744aa;
    }

    /* Frame Section */
    .frame-container {
      background: rgba(0, 0, 0, 0.7);
      border-radius: 12px;
      border: 1px solid #00e5ff30;
      box-shadow: 0 0 20px #00e5ff40;
      padding: 20px;
    }
    .frame-container img {
      width: 120px;
      margin: 8px;
      border-radius: 10px;
      transition: 0.3s ease;
      box-shadow: 0 0 10px #00e5ff40;
    }
    .frame-container img:hover {
      transform: scale(1.08);
      box-shadow: 0 0 20px #00e5ff90;
    }

    #message {
      color: #fff;
      font-size: 1.1rem;
    }

    /* Glow Text */
    .text-glow {
      color: #00e5ff;
      text-shadow: 0 0 10px #00e5ff80;
    }
  </style>
</head>
<body>

<!-- Navigation bar -->
<nav class="navbar navbar-expand-lg">
  <div class="container-fluid">
    <a class="navbar-brand" href="/"><b>DeepFake Video Detection </b></a>
    <div class="d-flex">
    </div>
  </div>
</nav>

<!-- Main container -->
<div class="container mt-5">
  <div class="card p-4 shadow-sm">
    <h2 class="mb-4 text-center">Welcome, üëÅÔ∏è</h2>
    <form id="uploadForm" enctype="multipart/form-data">
      <div class="mb-3">
        <label for="videoFile" class="form-label">Select Video:</label>
        <input type="file" class="form-control" id="videoFile" name="video" accept="video/*" required>
      </div>
      <div class="mb-3">
        <label for="frameRate" class="form-label">Choose Frame Rate (fps):</label>
        <select class="form-select" id="frameRate" name="frame_rate" required>
          <option value="5">5 fps</option>
          <option value="10">10 fps</option>
          <option value="15">15 fps</option>
          <option value="30">30 fps</option>
        </select>
      </div>
      <button type="submit" class="btn btn-primary w-100">Upload & Process</button>
    </form>
    <div id="message" class="mt-3 text-center fw-bold"></div>
  </div>

  <!-- Detection Summary Section -->
  <div id="summary-container" class="summary-container mt-4 text-center" style="display: none;">
    <h4 class="text-glow mb-3">üîç Deepfake Detection Summary</h4>
    <ul id="summary-list" class="text-light"></ul>
  </div>

  <!-- View Frames Button -->
  <button id="view-frames-btn" class="btn btn-success w-100 mt-4" style="display: none;">View Extracted Frames</button>

  <!-- Frame display -->
  <div id="frame-container" class="frame-container text-center" style="display: none;">
    <button id="close-view" class="btn btn-danger mb-3">Close View</button>
    <div id="frames" class="d-flex flex-wrap justify-content-center"></div>
  </div>
</div>

<!-- JavaScript Logic (unchanged) -->
<script>
  let frameStatuses = {};

  document.getElementById("uploadForm").addEventListener("submit", async function(event) {
    event.preventDefault();
    const formData = new FormData(this);
    document.getElementById("message").innerHTML = "Processing video... Please wait.";
    document.getElementById("summary-container").style.display = "none";
    document.getElementById("view-frames-btn").style.display = "none";

    const response = await fetch("/index", {
      method: "POST",
      body: formData
    });

    const result = await response.json();
    document.getElementById("message").innerHTML = result.message;

    if (result.message === "Video processed successfully!") {
      document.getElementById("view-frames-btn").style.display = "block";
      frameStatuses = result.frame_statuses;

      const summary = result.summary;
      const summaryList = document.getElementById("summary-list");
      summaryList.innerHTML = `
        <li>Total Images Processed: ${summary.total_images}</li>
        <li>Genuine Images: ${summary.genuine_count} (${summary.genuine_percentage.toFixed(2)}%)</li>
        <li>Deepfake Images: ${summary.deepfake_count} (${summary.deepfake_percentage.toFixed(2)}%)</li>
        <li><strong>Video Classification: ${summary.video_classification.toUpperCase()}</strong></li>
      `;
      document.getElementById("summary-container").style.display = "block";
    }
  });

  document.getElementById("view-frames-btn").addEventListener("click", async function () {
    const videoName = document.getElementById("videoFile").files[0].name.split('.')[0];
    const framesResponse = await fetch(`/view_frames/${videoName}`);
    const frames = await framesResponse.json();

    if (frames.length > 0) {
      const frameContainer = document.getElementById("frame-container");
      const framesDiv = document.getElementById("frames");
      framesDiv.innerHTML = '';

      frames.forEach(frameUrl => {
        const fileName = frameUrl.split('/').pop();
        const label = frameStatuses[fileName] || 'unknown';

        const imgElement = document.createElement("img");
        imgElement.src = frameUrl;
        imgElement.alt = "Frame";

        if (label === 'genuine') {
          imgElement.style.border = "3px solid #00e676";
        } else if (label === 'deepfake') {
          imgElement.style.border = "3px solid #ff1744";
        } else {
          imgElement.style.border = "2px dashed gray";
        }

        framesDiv.appendChild(imgElement);
      });

      frameContainer.style.display = "block";
    }
  });

  document.getElementById("close-view").addEventListener("click", function () {
    document.getElementById("frame-container").style.display = "none";
  });
</script>

</body>
</html>
